מסמך אפיון טכנולוגי: Catering OS // Module 2.3 גרסה 1.3.1



שם הרכיב: מנוע רכש ותכנון ייצור (Procurement & Production Engine)

גרסה: 1.3.1 (Decision-Driven Edition)

תאריך: 13/12/2025

בעלים: רועי (Product Owner)









1. תקציר מנהלים





מודול 2.3 מגשר בין תכנון האירוע (תפריט) לבין ביצוע רכש בפועל, תוך שמירה על מודל העבודה של שי: שליטה מלאה, שקיפות, ואפס ניחושים. המערכת מייצרת טיוטות להזמנות ספקים (Supplier Drafts), מציגה Preview מלא של הודעת הוואטסאפ, ומאפשרת Commit באמצעות Copy בלבד. כל שינוי אחרי Copy מחזיר את ההזמנה למצב Dirty ומחייב Copy מחדש.



המודול אינו “מחשבון” ואינו “AI מנחש”. הוא מנוע טיוטות חכם שמכבד החלטות של שי, לוכד ידע (כמו המרות ושמות קנוניים) רק כששי מזין אותו מפורשות, ומייצר Audit מלא דרך Snapshots וגרסאות Template.









2. ארכיטקטורת המערכת







2.1 שכבת הנתונים (Data Layer)





המקור (Source): קבצי JSON ב-Google Drive (תוצר של המרת Word).

גמישות הקלט (Robust Parsing): המערכת תומכת במבנה היררכי מלא (Event -> Stations -> Items) וגם ב-fallback למבנה שטוח (Flat Array) במקרה של בעיות מבניות, כדי לא להכשיל ריצה.



עקרון יסוד: שורת מקור ב-JSON היא “פריט” (ItemSource). כל איחוד/סיכום הוא שכבת תצוגה/טיוטה מעל המקור, לא שינוי של המקור.





2.2 שכבת העבודה (Workspace)





פלטפורמה: Google Sheets. הגיליון הוא זמני (Ephemeral) - נוצר מחדש בכל ריצה כדי להבטיח ניקיון נתונים ולהימנע מזיהום שבוע לשבוע.

סביבת פיתוח: קוד מקומי (Local Dev) ב-Cursor ומסונכרן ל-Apps Script באמצעות clasp.



עקרון UX טכני: הטבלה היא תצוגה בלבד. פעולות שמשנות דאטה מתבצעות בסיידבר בלבד.





2.2.1 ביצועים (Non-Functional Requirements)





כל בנייה/רענון של Workspace Sheet תתבצע בכתיבה באצווה (setValues) על טווחים גדולים, ולא כתיבה שורה-שורה.

קריאות מהגיליון יתבצעו באצווה (getValues) עם מינימום roundtrips.

יש להימנע מפעולות מחיקה/הוספה חוזרות של שורות בלולאה. במקום זה: מחיקה אחת של טווחים/גיליון, ואז כתיבה אחת של בלוקים.







2.2.2 Sidebar Responsiveness





ה-Sidebar יעבוד במודל Optimistic UI: שינוי מוצג מיד למשתמש.

Persist לשרת יקרה מיידית (או ב-batch עם debounce קצר), ולא “בסוף”.

במקרה כשל Persist: rollback או חיווי שגיאה שמחזיר את ה-state למצב הקודם.







2.3 שמירת נתונים ולמידה (Persistence & Learning)





Snapshot: בכל Copy (Commit) נשמר Snapshot של הטקסט המלא שהועתק, כולל מזהה גרסת ה-Template שהפיקה אותו (templateVersionId).

תיעוד שינויים (Diff Log): חובה לשמור את הפער בין מצב הטיוטה לבין מה שי בחר בפועל (לפחות ברמת “מה השתנה אחרי Copy” ובאיזה רגע).



Templates: נשמרים כישות מתמידה (ברמת ספק), כולל Versioning מיידי (כל שינוי מייצר גרסה חדשה).



הערה: החלטות ארכיטקטורת DB מעבר למה שנדרש ל-Templates/Versions/Snapshots נדחות לסשן ייעודי (לא חוסמות V1).





2.3.1 Audit Storage Strategy





Snapshots ו-Diff Log נשמרים כקבצי JSON ב-Google Drive (תיקיית logs/ או מבנה דומה).

ה-Sheet שומר אינדקס קל בלבד (IDs + מטא-דאטה), כדי למנוע התנפחות של הגיליון לאורך זמן.











3. לוגיקה עסקית (Business Logic)







3.1 אפס ניחושים (Zero Guessing)





איחוד קשיח: פריטים יאוחדו לשורה אחת רק אם יש התאמה מלאה בשם (קנוני או כפי שהוגדר) וביחידת המידה.

יחידות מעורבות: “בצל (ק”ג)” ו”בצל (ליטר)” נשארים שתי שורות נפרדות. המערכת לא מבצעת המרות יחידה אוטומטיות.



אין inference: אם שי רשם “עוגת שמרים מצדוק” המערכת לא מסיקה מזה ספק. שיוך ספק נעשה רק בפעולה מפורשת.





3.2 עקיבות מלאה (Traceability)





כל תוצר מסוכם שומר זיכרון של מקורותיו: אירוע + עמדה (Station) + הכמות המקורית.

הספק לא רואה את המקורות. שי כן (Drill פנימי בסיידבר).





3.3 רכש מול הכנות (Make vs Buy)





ברירת מחדל: כל פריט חדש נכנס כ-Unclassified (דורש החלטה).

סיווגים: Unclassified / Buy (Raw או Ready) / Prep.



Prep ב-V1: מוצג כרשימת צפייה בלבד (טאב “הכנות”). אין סטטוסים/משימות/מי מבצע. זה מודול נפרד בעתיד.





3.4 פריט מול פריט מסוכם





פריט (ItemSource): שורת מקור מה-JSON בהקשר אירוע/עמדה.

פריט מסוכם: איחוד לצורך תצוגה/טיוטה בלבד.



גבול סיכום: סיכום אוטומטי ברמת אירוע בלבד (לא מסכמים בין אירועים). זה מונע ערבוב טריות, משלוחים, ותזמונים.





3.5 Supplier Drafts, יום אספקה, וריבוי הזמנות לספק





יחידת ההזמנה היא Supplier + Delivery Day (לא “הזמנה שבועית”).

לאותו ספק יכולות להיות כמה הזמנות בשבוע (למשל דגים/ירקות כל יום בהתאם לאירועים).



יום אספקה הוא חוק של ספק, לא של פריט:



לכל ספק מוגדר Allowed Delivery Days (בחירה מרובה).

אין Default Delivery Day. שי חייב לבחור ידנית בכל הזמנה.

Copy חסום עד בחירת יום אספקה.





טיוטה נוצרת אוטומטית: ברגע שיש פריטים משויכים לספק, נוצרת טיוטה. אם לא נבחר יום אספקה, הטיוטה במצב Missing Delivery Day.





3.6 Copy is Commit + Dirty





Copy הוא Commit (נקודת אמת) כי המערכת לא שולחת הודעות בפועל.

כל Copy מייצר Snapshot.



Dirty: כל שינוי רלוונטי אחרי Copy מחזיר את ההזמנה למצב Dirty עד Copy מחדש.

שינויים שמלכלכים כוללים: שינוי כמות, שינוי ספק, שינוי יום אספקה, הוספת/הסרת שורה, שינוי Supplier Spec לפריט, שינוי Order Note להזמנה, ושינוי Template שמייצר הודעה אחרת.



Undo: פעולה אחת אחורה, רק לפעולות שבוצעו בסיידבר (כולל שינויי Template שנעשו דרך ה-Preview).





3.7 Templates ו-Versioning





Template הוא ברמת ספק.

Versioning מיידי: כל שינוי טקסט בטמפלט מייצר גרסה חדשה (immutable).

עריכה ב-V1: רק שי (Admin) יכול לערוך Template.



אין עריכת שורות חופשית: שורות הפריטים נגזרות מהדאטה בלבד. עריכת טקסט חופשית מותרת רק על ניסוח ה-Template (פתיח/סגירה/מבנה), לא על שורות הפריטים עצמן.





3.8 Supplier Spec, Order Note, וכללי איחוד שורות לספק





איחוד שורות בטיוטת ספק נעשה לפי:



שם (קנוני/כפי שהוגדר)

יחידה

Supplier Spec (אם קיים)





אם Supplier Spec משנה מוצר מבחינת הספק (למשל “עם עור” מול “בלי עור”) אלה שתי שורות נפרדות גם אם השם דומה.



Order Note הוא ברמת הזמנה (ספק + יום), טקסט חופשי (למשל “לא אחרי 09:00”).





3.9 המרות (Conversions)





אין סכימה בין יחידות שונות בלי המרה מוגדרת.

מתי מבקשים המרה: בזמן עבודה על הזמנה לספק, אם יש שורה שחוסמת איחוד/סכימה בגלל יחידה חסרה, המערכת מסמנת “נדרשת המרה” ופותחת חלונית/Sidebar ממוקד להגדרת ההמרה לפריט הזה בלבד.



המרה היא יחס נקי (ליטר -> ק”ג) בלי “אקסטרה להזמנה”. אקסטרה נשאר החלטת כמות נפרדת.





3.10 Cutoff (דדליין ספק)





דדליין מוגדר בשפה של ספק: “עד יום X בשעה Y” (יחסי ליום אספקה).

התנהגות: אם עבר cutoff, המערכת מציגה אזהרה ברורה, אבל לא חוסמת Copy.

החיווי יכול להופיע כבר בכניסה לעריכת ההזמנה (כדי שלא תהיה “הפתעה” ברגע Copy), אבל Audit מחייב נשמר ברגע Copy.





3.11 פיצול בין ספקים





אין Smart Split ב-V1.

אם שי רוצה לחלק כמות בין ספקים, הוא עושה זאת על ידי שכפול שורה/פריט, התאמת כמויות, ושיוך ספק לכל שורה.









4. מפרט חווית משתמש (UX/UI Specification)







4.1 מבנה הטבלה - היררכיה פתוחה (Open Hierarchy)





תפיסה: God View. שי רואה הכל מול העיניים, בלי Hover ובלי מסכים מיותרים.



היררכיה:



שורת אב (Parent): פריט מסוכם בתוך אירוע (שם, סה”כ, יחידה).

שורות בנים (Child): מקורות (↳ עמדה, וכמות מקורית). עמודת הסה”כ בשורות בנים ריקה כדי לא לשבש סכימה.





הטבלה היא תצוגה בלבד. כל פעולה מתבצעת בסיידבר.



Review Mode:



מצב טיפול לפריטים Unclassified בתוך הסיידבר.

Auto-Advance אחרי סיווג.

סדר קבוע: תאריך אירוע -> שם אירוע -> שם עמדה -> שם פריט.







4.2 ייצוא והפצה (Export Strategy)





Digital First: הטבלה לא מיועדת להדפסה.



היעד: הודעות לספקים בוואטסאפ, באמצעות Copy.



במקום “ייצוא בסוף האישור” יש מודל ביצוע מתמשך:



Tab ספקים מציג טיוטות הזמנה לפי ספק + יום.

בתוך הסיידבר של ההזמנה מוצג Preview מלא של הודעת הוואטסאפ (כפי שתועתק).

Copy הוא Commit, מייצר Snapshot.

שינוי אחרי Copy מציג Dirty ומחייב Copy מחדש.







4.3 שפה ותצוגה





כל הממשק (כותרות, הודעות, שגיאות) בעברית מלאה RTL.

הקוד הפנימי (משתנים, שמות פונקציות) באנגלית.









Scope Freeze V1 (Non-goals)





שליחה אוטומטית לספקים מתוך המערכת (WhatsApp/Email/SMS) - רק Copy.

התראות יזומות לפני דדליין - רק חיווי בזמן עבודה.

מודול הכנות מלא (סטטוסים/משימות/מי מבצע/תזמון) - רק רשימת צפייה.

ריבוי משתמשים והרשאות מלאות (Login/Roles) - כרגע שי בלבד.

עורך הודעה חופשי שמנתק הודעה מהדאטה - לא.

AI מנחש / ברירות מחדל שמחליטות במקום שי - לא.

Smart Split כמות לשני ספקים - לא; משתמשים בשכפול.

מלאי/מחירים/חשבוניות/מחסן - מחוץ ל-V1.



